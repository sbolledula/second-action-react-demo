name: repository-deployment workflow
on: push
jobs:
  approval:
    name: Wait for approval
    runs-on: ubuntu-latest
    steps:
      - name: Awaiting approval
        uses: trstringer/manual-approval@v1
        with:
          approvers: sboll
          timeout-minutes: 60
  test:
    name: Test job for ${{ github.repository }}
    runs-on: ubuntu-latest
    steps:
      - name: Get Code
        uses: actions/checkout@v3
      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install Depedencies
        run: npm ci
      - name: Run Tests
        run: npm test
  deploy:
    name: Deploy job for ${{ github.repository }}
    runs-on: ubuntu-latest
    needs: approval
    steps:
      - name: Get Code
        uses: actions/checkout@v3
      - name: Install Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
      - name: Install Depedencies
        run: npm ci
      - name: Build Project
        run: npm run build
      - name: Get repo name only
        run: echo "REPO_NAME=${{ github.repository }}" | awk -F'/' '{print $2}'
      - name: Deploy to GitHub
        run: echo "Deploying to GitHub..."
